var map,pointarray,heatmap,countyLayer,styles,mapData,graphData,MapHandler=function(){var e=new dataHandler,a=new google.maps.Geocoder,t=new GraphHandler;this.initialize=function(){var e={zoom:11,center:new google.maps.LatLng(45.52,-122.6819)};map=new google.maps.Map(document.getElementById("map-canvas"),e),this.codeAddress(),this.applyStyles(),this.loadKmlLayer(),this.contrastMap()},this.loadKmlLayer=function(){countyLayer=new google.maps.FusionTablesLayer({map:map,query:{select:"col13",from:"1INYs3gG9c8dwMlYGuraF9bSOLL5rd50MxLf4izU",where:""},options:{styles:[{polygonOptions:{strokeColor:"#FFFFFF",fillColor:"#FFFFFF",fillOpacity:"0"}}]}})},this.toggleCounties=function(){countyLayer.setMap(countyLayer.getMap()?null:map)},this.toggleHeatmap=function(){heatmap.setMap(heatmap.getMap()?null:map)},this.clearHeatmap=function(){heatmap.setMap(null)},this.applyStyles=function(){styles=[{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"geometry",stylers:[{visibility:"off"}]}],map.setOptions({styles:styles})},this.contrastMap=function(){styles=[{featureType:"road",stylers:[{visibility:"off"}]},{featureType:"transit",stylers:[{visibility:"off"}]},{featureType:"water",stylers:[{saturation:-100},{lightness:-75}]},{featureType:"landscape",stylers:[{lightness:67},{saturation:-100}]},{elementType:"labels.text.fill",stylers:[{weight:5.3},{lightness:-58}]},{featureType:"landscape.natural.terrain",stylers:[{hue:"#0099ff"},{color:"#808080"},{lightness:4}]},{featureType:"poi",stylers:[{saturation:-100},{visibility:"off"}]},{featureType:"road.highway",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{visibility:"on"},{saturation:-50}]},{featureType:"road.arterial",stylers:[{visibility:"on"}]}],map.setOptions({styles:styles})},this.changeGradient=function(){heatmap.setOptions({gradient:heatmap.get("gradient")?null:gradient})},this.changeRadius=function(){heatmap.setOptions({radius:heatmap.get("radius")?null:20})},this.changeOpacity=function(){heatmap.setOptions({opacity:heatmap.get("opacity")?null:.8})},this.codeAddress=function(){var s=$("#address").val(),i=$("input[name=group1]:checked").val();a.geocode({address:s},function(a,s){s==google.maps.GeocoderStatus.OK?(map.setCenter(a[0].geometry.location),mapData=e.getMapData(a,i),graphData=e.getGraphData(a,i),t.getGraph(graphData,"bar","#graph-container2"),t.getGraph(graphData,"area","#graph-container1"),pointArray=new google.maps.MVCArray(mapData),heatmap=new google.maps.visualization.HeatmapLayer({data:pointArray}),heatmap.setOptions({gradient:null,radius:20,opacity:1}),heatmap.setMap(map)):alert("Geocode was not successful for the following reason: "+s)})}};